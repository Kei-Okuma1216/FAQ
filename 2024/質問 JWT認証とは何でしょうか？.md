### Q.
- 質問です。そもそもJWT認証とは何でしょうか？

### A.
- JWT（JSON Web Token）認証は、ウェブアプリケーションやAPIで認証情報を安全に伝達するための標準規格の一つです。JWTは、ユーザーの認証情報やその他のデータを含むトークンを生成し、それをクライアントとサーバー間でやり取りします。以下に、JWT認証の基本的な概念を説明します。

### JWTの構造
JWTは3つの部分から構成されます：
1. **ヘッダー（Header）**:
    - トークンのタイプとアルゴリズム情報を含む
2. **ペイロード（Payload）**:
    - ユーザー情報や追加データを含む
3. **署名（Signature）**:
    - トークンの改ざん防止のために生成される

それぞれの部分はBase64URLエンコードされており、以下の形式で表されます：

```
header.payload.signature
```

### JWTの使用方法
1. **ユーザー認証**:
    - ユーザーがログインすると、サーバーはユーザーの認証情報を検証し、JWTを生成します。
2. **トークンの発行**:
    - クライアントにJWTを送信し、クライアントはこのトークンを保存します（例えば、ブラウザのローカルストレージやクッキーに保存）。
3. **認証リクエスト**:
    - クライアントが保護されたリソースにアクセスする際、JWTを含めてリクエストを送信します。
4. **トークンの検証**:
    - サーバーは受信したJWTの署名を検証し、トークンが有効かどうかを確認します。有効な場合、リクエストを許可します。

### メリット
- **ステートレス**: JWTは状態を持たないため、サーバー側でセッション情報を保存する必要がなく、スケーラビリティが向上します。
- **安全性**: トークンは署名されているため、改ざんされることが困難です。また、必要に応じて暗号化することも可能です。
- **柔軟性**: トークンにカスタムクレーム（データ）を含めることで、柔軟に情報を伝達できます。

### 例
以下は、JWTのペイロード部分の例です：

```json
{
  "sub": "1234567890",
  "name": "John Doe",
  "admin": true
}
```

これがBase64URLエンコードされてJWTの一部として利用されます。

### まとめ
JWT認証は、ウェブアプリケーションやAPIの認証と認可を効率的かつ安全に行うための有力な手段です。トークンベースの認証により、分散型システムやマイクロサービスアーキテクチャに適しています。

他に質問があれば、どうぞお知らせくださいね！😊


[セッション管理にJWTを使うと何が変わるの？](https://zenn.dev/swy/articles/0e8de582f4e7f3)<!--{:target="_blank"}-->

- セッションIDとJWTとでは、セッションの管理方法が違っている。
- 前者はDBに保持したセッションIDで有効性を確認するが、後者はJWTの中に「サーバの秘密鍵で署名されたデータ」を含んでおり、サーバーの公開鍵と照合することで有効性を確認している。
- またセッションＩＤはランダムな文字列を使用していたが、後者は任意のデータをJSON形式にしてBASE64URLエンコードした文字列を使用する。そこにユーザの情報やJWTの有効期限などを保存している。
- JWTのデメリットとしては、JWTのサイズがSession IDに比べて大きくなる点やJWTの中身を更新する仕組みが複雑になる点がある。また暗号化されていない点もある。
- ただ解説にあるように、AWSで使う場合、PostgreSQLのRLS(Row level security)と併用すると、マルチテナントのデータ混在した場合でも、楽に扱える様子。ただJWTのデータはイミュータブルに保つ必要があるなど制約はあるみたい（例 ユーザーIDなど不変データ）。

[PostgreSQLのRow_Level_Securityを検証する](
https://zenn.dev/taxin/articles/postgresql-row-level-security-policy)

[基本から理解するJWTとJWT認証の仕組み](https://developer.mamezou-tech.com/blogs/2022/12/08/jwt-auth/)
- JSONのキーと値のペアはJWTでは「クレーム(Claim)」と呼び、キー名は「クレーム名」、値は「クレーム値」と呼ばれます。
- JWTで予約されているクレーム名は「登録クレーム名(Registered Claim Names)」と呼ばれます。
- JWTを改ざん防止のため暗号化したのがJWS(JSON Web Signature)で、JWTを暗号化し中身自体を見られなくしたのがJWE(JSON Web Encryption)である。
- 途中引用「～JWT認証はIDとパスワードの代わりに自身が信頼していているアプリが発行した認証情報のJWTを提示してもらい、そのJWTを信頼したアプリと取り交わした鍵情報で検証することで、JWTに書かれているユーザ本人だと確認することとなります。」
- IDとパスワードをネットワークに流す代わりに、アプリが発行するJSONを流す。
